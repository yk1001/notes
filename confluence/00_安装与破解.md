1,下载docker
---
	docker pull atlassian/confluence-server:6.6
	docker pull registry.cn-hangzhou.aliyuncs.com/docker-org/mysql:5.7
	#版本一定要对
2,启动mysql
---
	mkdir -p /var/mysql/conf
	mkdir -p /var/mysql/data
	vi /var/mysql/conf/config-file.cnf
	[mysql]
	#设置mysql客户端默认字符集
	default-character-set=utf8
	[mysqld]
	default-storage-engine=INNODB
	character_set_server=utf8mb4
	innodb_default_row_format=DYNAMIC
	innodb_large_prefix=ON
	innodb_log_file_size=2G
	sql_mode = NO_AUTO_VALUE_ON_ZERO
	transaction-isolation=READ-COMMITTED
	binlog_format=row
	
	sudo docker run --name mysql -v /var/mysql/conf:/etc/mysql/conf.d -v /var/mysql/data:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d registry.cn-hangzhou.aliyuncs.com/docker-org/mysql:5.7
3,创建confluence需要的库
---
	#可以参考 https://confluence.atlassian.com/adminjiraserver/connecting-jira-applications-to-a-database-938846850.html
	CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;
	GRANT ALL PRIVILEGES ON confluence.* TO 'root'@'%' IDENTIFIED BY '123456';
	flush privileges;
4,启动confluence
---
	mkdir -p /var/atlassian/confluence
	sudo docker run --user root:root -d --name confluence -p 8090:8090 -p 8091:8091 -v /var/atlassian/confluence:/var/atlassian/application-data/confluence -m 4096M atlassian/confluence-server:6.6
5,启动
---
	访问 http://127.0.0.1:8090
	配置数据库 (要配置一个当前浏览器所在机器 能够连接到的mysql server),下载mysql驱动放在 /opt/atlassian/confluence/confluence/WEB-INF/lib/ 下
	数据库配置url:
	jdbc:mysql://address=(protocol=tcp)(host=192.168.1.106)(port=12003)/jira?sessionVariables=default_storage_engine=InnoDB
	配置密钥需要在atlassian 注册一个账号，按步骤生成
	网速原因，可能访问不到atlassian
6,破解
---
     下载 atlassian-extras-decoder-v2-3.2.jar 破解补丁
	docker cp atlassian-extras-decoder-v2-3.2.jar ${cid}:/opt/atlassian/confluence/confluence/WEB-INF/lib/
7,设置JVM启动参数
---
    #进入容器，copy /opt/atlassian/confluence/bin/setenv.sh 到宿主机
    docker exec -it ${cid} bash
    #编辑setenv
    vi setenv.sh
    JAVA_OPTS="-Xms3072m -Xmx4096m -XX:MaxPermSize=512m $JAVA_OPTS -Djava.awt.headless=true"
    export JAVA_OPTS
    #copy setenv 到容器中
    docker cp setenv.sh ${cid}:/opt/atlassian/confluence/bin/setenv.sh
8，重启docker
---
    docker restart ${cid}
	